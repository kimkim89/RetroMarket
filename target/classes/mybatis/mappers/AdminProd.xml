<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.AdminProd">

	<!-- 상품 등록(insert) -->
 	<insert id="adminProdInsert" parameterType="adminProdVO">
 		insert into product_info
		values(#{mk_idx}, #{mk_product_id}, #{mk_product_name}, #{mk_product_price}, #{mk_product_discount_price},
 			   #{mk_product_category}, #{mk_product_type}, #{mk_original_thumb}, #{mk_stored_thumb}, #{mk_thumb_size}, #{mk_status}, #{mk_content},
			   #{mk_original_upfile}, #{mk_stored_upfile}, #{mk_upfile_size}, #{mk_inventory}, now(), 
			   now(), 10, 20, #{mk_writer_ip});
	</insert>
	
	<!-- 전체 상품목록(select) -->
	<select id="adminProductSelect" resultType="adminProdVO" parameterType="java.util.HashMap">
		select * from product_info as a 
	    LEFT JOIN product_sort as b on a.mk_product_type = b.ps_sort_id 
	    LEFT JOIN product_category as c on a.mk_product_category = c.pc_category_id 
	    <if test="searchField != '' ">
		where ${searchField} like concat('%', #{keyword}, '%')
		</if>
	    order by a.mk_idx desc limit #{pageFirst}, #{pageSize};
	</select>
	
	<!-- 상품수정페이지: 개별 상품정보 출력(select) -->
	<select id="adminSelectOneProd" parameterType="int" resultType="adminProdVO">
		select * from product_info as pr_info join product_sort as pr_sort on pr_info.mk_product_type = pr_sort.ps_sort_id where pr_info.mk_idx = #{mk_idx} order by pr_info.mk_idx desc;
	</select>

	<!-- 상품수정(update) -->
	<update id="adminProdUpdate" parameterType="adminProdVO">
		update product_info 
		set mk_product_name = #{mk_product_name}, 
			mk_product_price = #{mk_product_price}, 
			mk_product_category = #{mk_product_category}, 
			mk_product_type = #{mk_product_type},
		<if test="mk_original_thumb != null"> 
			mk_original_thumb = #{mk_original_thumb}, 
			mk_stored_thumb = #{mk_stored_thumb}, 
			mk_thumb_size = #{mk_thumb_size},
		</if> 
			mk_status = #{mk_status}, 
			mk_content = #{mk_content}, 
		<if test="mk_original_upfile != null">
			mk_original_upfile = #{mk_original_upfile}, 
			mk_stored_upfile = #{mk_stored_upfile}, 
			mk_upfile_size = #{mk_upfile_size}, 
		</if>
			mk_inventory = #{mk_inventory},  
			mk_writer_ip = #{mk_writer_ip}
		where mk_idx = ${mk_idx};
	</update>

	<!-- 상품 분류(신상품/인기상품/할인상품) -->
	<select id="selectProdSort" resultType="adminProdVO">
		select * from product_sort;	
	</select>
	
	<!-- 상품 종류(스낵/젤리/캔디/기타) -->
	<select id="selectProdCategory" resultType="adminProdVO">
		select * from product_category;	
	</select>
 
 	<!-- 상품 삭제 -->
 	<delete id="adminProdDelete" parameterType="int">
 		delete from product_info where mk_idx = #{mk_idx};
 	</delete>
 	
 	<!-- 전체 상품 개수 출력  -->
 	<select id="countProd" resultType="int" parameterType="java.util.HashMap">
		select count(*) from product_info		
		<if test="searchField != '' "	>
		where ${searchField} like concat('%', #{keyword}, '%')
		</if>
		order by mk_idx desc;
	</select>
 
 
</mapper>