<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.MyPage">

	<select id="MyInfo" resultType="memberVO" parameterType="String">
		select * from member where id = #{id};
	</select>
	
	
	<update id="ModifyAction" parameterType="hashMap">
		<if test="type == 1">
			update member set phone = #{mypageVO.phone} , address1 = #{mypageVO.address1} , 
			address2 = #{mypageVO.address2} , address3 = #{mypageVO.address3} , nickname = #{mypageVO.nickname} where id = #{mypageVO.id}
		</if>
		<if test="type == 2">
			update member set pwd = #{mypageVO.pwd} ,  phone = #{mypageVO.phone} , address1 = #{mypageVO.address1} , 
			address2 = #{mypageVO.address2} , address3 = #{mypageVO.address3} , nickname = #{mypageVO.nickname} where id = #{mypageVO.id} 
		</if>
	</update>
	
	
	<!-- 마이페이지: 주문 내역(주문번호) 조회 -->
	<select id="selectMyOrderHistory"  resultType="map" parameterType="map">
		select distinct(t1.order_code), t1.order_status, t2.order_status_name
			from product_order as t1
			inner join order_status_info as t2
			on t1.order_status = t2.order_status_code
			inner join cart as t3
			on t1.order_code = t3.order_num
			where t1.member_id = #{userId}	
			and t3.order_num is not null		
			order by t1.order_code desc
			limit #{pageFirst}, #{pageSize};	
	</select>
	
	
	<!-- 마이페이지: 주문 정보 중 상품 정보 조회 -->
	<select id="selectMyOrderProdList" parameterType="map" resultType="map">
		select t1.cart_idx, t1.order_num, t1.pr_idx, t1.pr_name, t1.total_num, t1.pr_price, t2.mk_stored_thumb
			from cart as t1
			inner join product_info as t2
			on t1.pr_code = t2.mk_product_id		
			where t1.order_num = #{orderNumber}
<!-- 			and t1.cart_idx = #{cartIdx} -->
			order by t1.cart_idx desc;		
	</select>
	
	
	<!-- 마이페이지: 주문 목록 총 개수 구하기 -->
	<select id="countMyPageOrderList" resultType="int" parameterType="String">
		select count(distinct(order_num)) from cart where member_id = #{userId} and order_num is not null;	     
	</select>
	
	
	<!-- 마이페이지: 주문번호별 상세 내역 조회 -->
	<select id="selectOneOrderHistory" resultType="orderHistoryDTO" parameterType="map">
		select distinct(t1.order_code), t1.order_status, t3.order_status_name
			from product_order as t1
			inner join order_status_info as t3
			on t1.order_status = t3.order_status_code
			inner join cart as t2
			on t1.order_code = t2.order_num
			where t1.member_id = #{userId}
			and t1.order_code = #{orderCode}
			order by t1.order_code desc
			limit 1;		
	</select>
	
	<!-- 특정 주문번호의 장바구니 index번호 조회 -->
	<select id="selectMyCartIdxList" resultType="orderHistoryDTO" parameterType="String">
		select cart_idx, order_num from cart where order_num = #{orderNumber};
	</select>

	
	
</mapper>