<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.MyPage">

	<select id="MyInfo" resultType="memberVO" parameterType="String">
		select * from member where id = #{id};
	</select>
	
	<update id="ModifyAction" parameterType="hashMap">
		<if test="type == 1">
			update member set phone = #{mypageVO.phone} , address1 = #{mypageVO.address1} , 
			address2 = #{mypageVO.address2} , address3 = #{mypageVO.address3} , nickname = #{mypageVO.nickname} where id = #{mypageVO.id}
		</if>
		<if test="type == 2">
			update member set pwd = #{mypageVO.pwd} ,  phone = #{mypageVO.phone} , address1 = #{mypageVO.address1} , 
			address2 = #{mypageVO.address2} , address3 = #{mypageVO.address3} , nickname = #{mypageVO.nickname} where id = #{mypageVO.id} 
		</if>
	</update>
	
	<!-- My Page 주문 내역 조회 -->
	<select id="selectMyOrderHistory"  resultType="orderHistoryDTO" parameterType="map">
		select t1.order_code, t1.order_status, t2.order_status_name
		from product_order as t1
		left join order_status_info as t2
		on t1.order_status = t2.order_status_code
		where t1.member_id = #{userId}
		order by t1.order_code desc
		limit #{pageFirst}, #{pageSize};
	</select>
	
	
	<select id="selectMyOrderProdList" parameterType="String" resultType="map">
		select *
		from cart as t1
		left join product_info as t2
		on t1.pr_idx = t2.mk_idx
		left join product_file as t3
		on t2.mk_product_id = t3.pf_product_id
		where t1.order_num = #{orderNumber}
		order by t1.cart_idx;
	</select>
	
	<!-- 주문 목록 총 개수 구하기 -->
	<select id="countMyPageOrderList" resultType="int" parameterType="String">
		select count(*)
		from product_order as t1
		left join order_status_info as t2
		on t1.order_status = t2.order_status_code
		where t1.member_id = #{userId}
	</select>
</mapper>